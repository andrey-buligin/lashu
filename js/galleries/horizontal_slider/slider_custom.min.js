/*! lashu - v0.0.1 - 2013-11-24
* http://www.ladylash.co.uk
* Copyright (c) 2013 ; Licensed  */
$.fn.imagesLoaded=function(e){function s(){e.call(r,t)}function o(){--n<=0&&this.src!==i&&(setTimeout(s),t.off("load error",o))}var t=this.find("img"),n=t.length,r=this,i="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return n||s(),t.on("load error",o).each(function(){if(this.complete||this.complete===undefined){var e=this.src;this.src=i,this.src=e}}),this},function(e,t,n){t.elastislide=function(e,n){this.$el=t(n),this._init(e)},t.elastislide.defaults={speed:450,easing:"",imageW:190,margin:3,border:2,minItems:1,current:0,onClick:function(){return!1}},t.elastislide.prototype={_init:function(e){this.options=t.extend(!0,{},t.elastislide.defaults,e),this.$slider=this.$el.find("ul"),this.$items=this.$slider.children("li"),this.itemsCount=this.$items.length,this.$esCarousel=this.$slider.parent(),this._validateOptions(),this._configure(),this._addControls(),this._initEvents(),this.$slider.show(),this._slideToCurrent(!1)},_validateOptions:function(){this.options.speed<0&&(this.options.speed=450),this.options.margin<0&&(this.options.margin=4),this.options.border<0&&(this.options.border=1);if(this.options.minItems<1||this.options.minItems>this.itemsCount)this.options.minItems=1;this.options.current>this.itemsCount-1&&(this.options.current=0)},_configure:function(){this.current=this.options.current,this.visibleWidth=this.$esCarousel.width(),this.visibleWidth<this.options.minItems*(this.options.imageW+2*this.options.border)+(this.options.minItems-1)*this.options.margin?(this._setDim((this.visibleWidth-(this.options.minItems-1)*this.options.margin)/this.options.minItems),this._setCurrentValues(),this.fitCount=this.options.minItems):(this._setDim(),this._setCurrentValues()),this.$slider.css({width:this.sliderW})},_setDim:function(e){this.$items.css({marginRight:this.options.margin,width:e?e:this.options.imageW+2*this.options.border}).children("a").css({borderWidth:this.options.border})},_setCurrentValues:function(){this.itemW=this.$items.outerWidth(!0),this.sliderW=this.itemW*this.itemsCount,this.visibleWidth=this.$esCarousel.width(),this.fitCount=Math.floor(this.visibleWidth/this.itemW)},_addControls:function(){this.$navNext=t('<span class="es-nav-next">Next</span>'),this.$navPrev=t('<span class="es-nav-prev">Previous</span>'),t('<div class="es-nav"/>').append(this.$navPrev).append(this.$navNext).appendTo(this.$el)},_toggleControls:function(e,t){e&&t?t===1?e==="right"?this.$navNext.show():this.$navPrev.show():e==="right"?this.$navNext.hide():this.$navPrev.hide():(this.current===this.itemsCount-1||this.fitCount>=this.itemsCount)&&this.$navNext.hide()},_initEvents:function(){var n=this;t(e).on("resize.elastislide",function(e){n._reload(),clearTimeout(n.resetTimeout),n.resetTimeout=setTimeout(function(){n._slideToCurrent()},200)}),this.$navNext.on("click.elastislide",function(e){n._slide("right")}),this.$navPrev.on("click.elastislide",function(e){n._slide("left")}),this.$slider.on("click.elastislide","li",function(e){return n.options.onClick(t(this)),!1}),n.$slider.touchwipe({wipeLeft:function(){n._slide("right")},wipeRight:function(){n._slide("left")}})},reload:function(e){this._reload(),e&&e.call()},_reload:function(){var e=this;e._setCurrentValues(),e.visibleWidth<e.options.minItems*(e.options.imageW+2*e.options.border)+(e.options.minItems-1)*e.options.margin?(e._setDim((e.visibleWidth-(e.options.minItems-1)*e.options.margin)/e.options.minItems),e._setCurrentValues(),e.fitCount=e.options.minItems):(e._setDim(),e._setCurrentValues()),e.$slider.css({width:e.sliderW+10})},_slide:function(e,r,i,s){var o=parseFloat(this.$slider.css("margin-left"));if(r===n){var u=this.fitCount*this.itemW,r;if(u<0)return!1;if(e==="right"&&this.sliderW-(Math.abs(o)+u)<this.visibleWidth)u=this.sliderW-(Math.abs(o)+this.visibleWidth)-this.options.margin,this._toggleControls("right",-1),this._toggleControls("left",1);else if(e==="left"&&Math.abs(o)-u<0)u=Math.abs(o),this._toggleControls("left",-1),this._toggleControls("right",1);else{var a;e==="right"?a=Math.abs(o)+this.options.margin+Math.abs(u):a=Math.abs(o)-this.options.margin-Math.abs(u),a>0?this._toggleControls("left",1):this._toggleControls("left",-1),a<this.sliderW-this.visibleWidth?this._toggleControls("right",1):this._toggleControls("right",-1)}e==="right"?r="-="+u:r="+="+u}else{var a=Math.abs(r);Math.max(this.sliderW,this.visibleWidth)-a<this.visibleWidth&&(r=-(Math.max(this.sliderW,this.visibleWidth)-this.visibleWidth),r!==0&&(r+=this.options.margin),this._toggleControls("right",-1),a=Math.abs(r)),a>0?this._toggleControls("left",1):this._toggleControls("left",-1),Math.max(this.sliderW,this.visibleWidth)-this.visibleWidth>a+this.options.margin?this._toggleControls("right",1):this._toggleControls("right",-1)}t.fn.applyStyle=i===n?t.fn.animate:t.fn.css;var f={marginLeft:r},l=this;this.$slider.stop().applyStyle(f,t.extend(!0,[],{duration:this.options.speed,easing:this.options.easing,complete:function(){s&&s.call()}}))},_slideToCurrent:function(e){var t=this.current*this.itemW;this._slide("",-t,e)},add:function(e,t){this.$items=this.$items.add(e),this.itemsCount=this.$items.length,this._setDim(),this._setCurrentValues(),this.$slider.css({width:this.sliderW}),this._slideToCurrent(),t&&t.call(e)},setCurrent:function(e,t){this.current=e;var n=Math.abs(parseFloat(this.$slider.css("margin-left"))),r=n+this.visibleWidth,i=Math.abs(this.current*this.itemW);(i+this.itemW>r||i<n)&&this._slideToCurrent(),t&&t.call()},destroy:function(e){this._destroy(e)},_destroy:function(n){this.$el.off(".elastislide").removeData("elastislide"),t(e).off(".elastislide"),n&&n.call()}};var r=function(e){this.console&&console.error(e)};t.fn.elastislide=function(e){if(typeof e=="string"){var n=Array.prototype.slice.call(arguments,1);this.each(function(){var i=t.data(this,"elastislide");if(!i){r("cannot call methods on elastislide prior to initialization; attempted to call method '"+e+"'");return}if(!t.isFunction(i[e])||e.charAt(0)==="_"){r("no such method '"+e+"' for elastislide instance");return}i[e].apply(i,n)})}else this.each(function(){var n=t.data(this,"elastislide");n||t.data(this,"elastislide",new t.elastislide(e,this))});return this}}(window,jQuery),$(function(){var e=$("#rg-gallery"),t=e.find("div.es-carousel-wrapper"),n=t.find("ul > li"),r=n.length;typeof gallery_slideshow_delay=="undefined"&&(gallery_slideshow_delay=4e3),Gallery=function(){var i=0,s=0,o="carousel",u=gallery_slideshow_delay,a=null,f=function(){n.add('<img src="images/skins/konsus/building/ajax-loader.gif"/>').imagesLoaded(function(){h(),m(n.eq(i),"init")}),o==="carousel"&&l()},l=function(){typeof gallery_carousel_speed=="undefined"&&(gallery_carousel_speed=450),typeof gallery_carousel_image_width=="undefined"&&(gallery_carousel_image_width=158),typeof gallery_carousel_easing=="undefined"&&(gallery_carousel_easing=""),t.show().elastislide({speed:gallery_carousel_speed,imageW:gallery_carousel_image_width,easing:gallery_carousel_easing,onClick:function(e){s=i,i=e.index(),m(e)}}),t.elastislide("setCurrent",i)},c=function(){var n=$('<a href="#" class="rg-view-full"></a>'),r=$('<a href="#" class="rg-view-thumbs rg-view-selected"></a>');e.prepend($('<div class="rg-view"/>').append(n).append(r)),n.on("click.rgGallery",function(e){return o==="carousel"&&t.elastislide("destroy"),t.hide(),n.addClass("rg-view-selected"),r.removeClass("rg-view-selected"),o="fullview",!1}),r.on("click.rgGallery",function(e){return l(),r.addClass("rg-view-selected"),n.removeClass("rg-view-selected"),o="carousel",!1}),o==="fullview"&&n.trigger("click")},h=function(){$("#img-wrapper-tmpl").tmpl({itemsCount:r}).prependTo(e),buttons=$(".bg-img-button");if(r>1){var t=e.find("a.rg-image-nav-prev"),n=e.find("a.rg-image-nav-next"),i=e.find("a.rg-image-slideshow"),s=e.find("div.rg-image");t.on("click.rgGallery",function(e){return d(),v("left"),!1}),n.on("click.rgGallery",function(e){return d(),v("right"),!1}),i.on("click.rgGallery",function(e){return $(this).hasClass("stop")?d():p(),!1}),s.touchwipe({wipeLeft:function(){v("right")},wipeRight:function(){v("left")},preventDefaultEvents:!1}),$(document).on("keyup.rgGallery",function(e){e.keyCode==39?v("right"):e.keyCode==37&&v("left")})}},p=function(){e.find("a.rg-image-slideshow").text("Stop slideshow").addClass("stop"),a=setInterval(function(){v("right")},u)},d=function(){e.find("a.rg-image-slideshow").text("Play slideshow").removeClass("stop"),clearInterval(a)},v=function(e){s=i,e==="right"?i+1>=r?i=0:++i:e==="left"&&(i-1<0?i=r-1:--i),m(n.eq(i))},m=function(r,u){var a=s;if(i==a&&u!=="init")return;var f=e.find("div.rg-loading").show();n.removeClass("selected"),r.addClass("selected");var l=r.find("img"),c=l.data("large"),h=l.attr("title"),p=l.data("description");$("<img/>").load(function(){e.find("span.rg-image-pos-current").text(i+1);if(u!=="init"){var n=e.find("img").filter(":first"),r=n.width(),s=$('<img alt="" src="'+c+'">').css("left",r+"px");e.find("div.rg-image").find("img").length>1&&e.find("div.rg-image").find("img:last").remove(),e.find("div.rg-image").prepend(s);var l=s.width();i<a&&(s.css("left",-l+"px"),r=-l),e.find("div.rg-image-container").stop().animate({width:l+"px",height:s.height()+"px",useTranslate3d:!0},350),s.stop().animate({left:"0px",useTranslate3d:!0},350),n.stop().animate({left:-r+"px",useTranslate3d:!0},350)}else img=$('<img alt="" src="'+c+'">').load(function(){self=$(this),e.find("div.rg-image").append(this).addClass("loaded"),e.find("div.rg-image-container").width(self.width()).height(self.height())});h&&e.find("h2.rg-caption").show().empty().text(h),p&&e.find("div.rg-description").show().empty().html(p),f.hide(),o==="carousel"&&(t.elastislide("reload"),t.elastislide("setCurrent",i))}).attr("src",c)},g=function(e){t.find("ul").append(e),n=n.add($(e)),r=n.length,t.elastislide("add",e)};return{init:f,addItems:g}}(),Gallery.init()});